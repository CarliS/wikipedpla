var wp={title:$("#firstHeading").text(),categories:[],otherTitles:[],redirects:[],getCategories:function(){$("#mw-normal-catlinks li").each(function(t,e){wp.categories.push($(e).text())})},getOtherTitles:function(){$(".dablink").each(function(t,e){test=$(e).text().match('"(.*)" redirects here.'),test&&wp.otherTitles.push(test[1])})}},apiKey="e4c036f3302aad8d8c188683967b9619",apiBase="http://api.dp.la/v2/items",catCounter=0,titleCounter=0,dpla={},suggestions=[],buildURI=function(t){return apiBase+"?api_key="+apiKey+"&q="+encodeURIComponent(t)+"&callback=_handleResponse"},getData=function(t){$("body").append('<script src="'+buildURI(t)+'"></script>')},_handleResponse=function(t){dpla=t;var e=dpla.docs.length;e>0?buildSuggestions(displaySuggestions):titleCounter<wp.otherTitles.length?(getData(wp.otherTitles[titleCounter]),titleCounter++):catCounter<wp.categories.length&&(getData(wp.categories[catCounter]),catCounter++)},buildSuggestions=function(t){var e=dpla.docs,i={};e.forEach(function(t){var e=t.sourceResource;i.title=$.isArray(e.title)?e.title[0]:e.title,i.uri=t.isShownAt,i.type=$.isArray(e.type)?e.type[1]:e.type,i.isImage=isItAnImage(e),suggestions.push(i),i={}}),"function"==typeof t&&t()},displaySuggestions=function(){var t='<style>.dp-img:after { content: " "; background: url(https://upload.wikimedia.org/wikipedia/commons/a/a3/VisualEditor_-_Icon_-_Picture.svg); width: 12px; height: 12px; display: inline-block; background-size: 12px 12px;} }</style><div id="wikipedpla" class="dablink" style="display:none;"><a href="http://dp.la">DPLA</a> items of possible interest:',e=!1;suggestions.forEach(function(i,a,n){a==n.length-1&&(e=!0),e&&(t+=" & "),t+=' <a href="'+i.uri+'"',i.isImage&&(t+=' class="dp-img"'),t+=">"+i.title,t+=e?"</a>.":"</a>,"}),t+="</div>",$("#mw-content-text").prepend(t),$("#wikipedpla").show("slow")},isItAnImage=function(t){var e=t.type;if($.isArray(i)){for(var i in e)if("image"==i.toLowerCase())return!0;return!1}return e&&"image"===e.toLowerCase()?!0:!1},init=function(){var t=$('li[id^="ca-nstab-"]').attr("id");window._handleResponse||(window._handleResponse=_handleResponse),"main"===t.substr(-4)&&(wp.getCategories(),wp.getOtherTitles(),getData(wp.title))};init();